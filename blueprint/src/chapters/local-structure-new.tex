\chapter{Local structure}

This chapter serves for the commutative algebra preparation of the remaining part of the paper. The key results are
\begin{enumerate}
  \item \Cref{thm:ind-etale-w-contractible-cover-exists} expressing that every affine scheme has a w-contractible cover in the proetale site.
  \item \Cref{thm:weakly-etale-ind-etale} expressing that every weakly etale map can be covered by ind-etale maps.
\end{enumerate}

% Question: Can we avoid using weakly etale algebra, only use ind-etale algebra? This would need a modification of theorem 5.4.2, by directly mimicking the proof of topological invariance of étale sites for weakly étale.
% If so, we can remove theorem \Cref{thm:weakly-etale-ind-etale} and every dependency of it.
\section{Preliminaries}

\begin{definition}[Extremally disconnected space]
  \label{def:extremally-disconnected}
  \lean{ExtremallyDisconnected}
  \mathlibok

  A topological space \(X\) is \emph{extremally disconnected} if the closure of every open subset is open.
\end{definition}

\begin{definition} [Stone-Čech compactification]
  \label{def:stone-cech-compactification}
  \lean{StoneCech}
  \mathlibok

  Let \(X\) be a topological space. The \emph{Stone-Čech compactification} of \(X\) is the
  profinite space \(\beta(X)\) such that
  \begin{enumerate}
    \item \(X\) is dense in \(\beta(X)\);
    \item every continuous map \(f: X \to Y\) to a compact Hausdorff space \(Y\)
        extends uniquely to a continuous map \(\beta(f): \beta(X) \to Y\).
  \end{enumerate}
  We denote the Stone-Čech compactification of \(X\) by \(\beta(X)\).
\end{definition}

\begin{theorem}
    Let \(X\) be a topological space. Then the Stone-Čech compactification \(\beta(X)\) is extremally disconnected.
    \label{thm:stone-cech-extremally-disconnected}
    \uses{def:extremally-disconnected, def:stone-cech-compactification}
    \lean{StoneCech.projective}
    \mathlibok
\end{theorem}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/090D}{Tag 090D}]{stacks-project}}]
  Let $X$ be a quasi-compact Hausdorff space. There exists a continuous surjection $X' \to X$ with $X'$ quasi-compact, Hausdorff, and extremally disconnected.
  \label{thm:extremally-disconnected-cover}
  \uses{def:extremally-disconnected, def:stone-cech-compactification}
\end{proposition}

\begin{proof}
  \uses{thm:stone-cech-extremally-disconnected}
  Let $Y=X$ but endowed with the discrete topology. Let $X'=\beta (Y)$, which is extremally disconnected by \Cref{thm:stone-cech-extremally-disconnected}. The continuous map $Y \to X$ factors as $Y \to X' \to X$.
\end{proof}

\begin{definition}[Local isomorphisms, {\cite[\href{https://stacks.math.columbia.edu/tag/096E}{Tag 096E}]{stacks-project}}]
  \label{def:local-isomorphism}

  We say $A \to B$ is a \emph{local isomorphism} if for every prime $\mathfrak{q} \subset B$ there exists a $g \in B$, $g \notin \mathfrak{q}$ such that $A \to B_g$ induces an open immersion $\Spec (B_g) \to \Spec (A)$.
\end{definition}

\begin{definition}[Identify local rings, {\cite[\href{https://stacks.math.columbia.edu/tag/096E}{Tag 096E} (2)]{stacks-project}}]
  A ring map $A \to B$ \emph{identifies local rings} if for every prime $\mathfrak{q} \subset B$ the canonical map $A_{\varphi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}$ is an isomorphism.
  \label{def:identify-local-rings}
\end{definition}

\section{Henselian objects and Henselisation}

In this section we define a generalisation of the notion of a Henselian ring to an arbitrary category. Let $\mathcal{C}$ be a category
and $P$ a property of morphisms.

\begin{definition}[Henselian]
    A morphism $f\colon X \to Y$ is $P$-\emph{Henselian}, if for every factorisation
    \[
    \begin{tikzcd}
        X \arrow{r}{u} \arrow[swap]{dr}{f} & Z \arrow{d}{v} \\
                    & Y,
    \end{tikzcd}
    \] with $u$ satisfying $P$, there exists a retraction of $u$.
\end{definition}

\begin{example}
    A local ring $(R, \mathfrak{m}, \kappa)$ is Henselian if and only if the projection $R \to \kappa$ is étale-Henselian.
\end{example}

\begin{proof}
    By {\cite[\href{https://stacks.math.columbia.edu/tag/04GG}{Tag 04GG}]{stacks-project}}, $R$ is Henselian if and only if
    for any étale ring map $R \to S$ and prime $\mathfrak{q}$ of $S$ lying over $\mathfrak{m}$ with $\kappa = \kappa(\mathfrak{q})$,
    there exists a retraction $S \to R$ of $R \to S$.

    Suppose $R$ is Henselian and let $R \to S \to \kappa$ be a factorisation of $R \to \kappa$. Then
    $\mathfrak{q} = \mathrm{ker}(S \to \kappa)$ is a prime ideal of $S$ lying above $\mathfrak{m}$. Hence we obtain a commutative
    diagram
    \[
        \begin{tikzcd}
        R \arrow{r} \arrow{d} & S \arrow{r} \arrow{d} & \kappa \\
        \kappa \arrow[dashed]{r} & \kappa(\mathfrak{q}) \arrow[dashed]{ur},
        \end{tikzcd}
    \] where the composition of the dashed arrows is the identity of $\kappa$. Hence $\kappa(\mathfrak{q}) = \kappa$ and by assumption,
    $R \to S$ has a retraction.

    Now assume that $R \to \kappa$ is étale-Henselian and let $R \to S$ be étale and $\mathfrak{q}$ be a prime ideal of $S$ with
    $\kappa(\mathfrak{q}) = \kappa$. Hence the composition $R \to S \to \kappa(\mathfrak{q}) = \kappa$ is a factorisation
    of $R \to \kappa$. Thus $R \to S$ has a retraction.
\end{proof}

% TODO: add definition of Henselisation if needed

\begin{definition}[Strictly Henselian local ring]
    \label{def:strictly-henselian-local-ring}
    A local ring $(R, \mathfrak{m}, \kappa)$ is \emph{strictly henselian} if the composition $R \to \kappa \to \kappa^{\mathrm{sep}}$ is étale-Henselian
    for a separable closure $\kappa^{\mathrm{sep}}$.
\end{definition}

The following example shows that our definition agrees with the one in
\cite[\href{https://stacks.math.columbia.edu/tag/04GF}{Tag 04GF}]{stacks-project}.

\begin{example}
    A local ring $(R, \mathfrak{m}, \kappa)$ is strictly Henselian if and only if it is Henselian and $\kappa$ is separably closed.
\end{example}

% \begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/04GH}{Tag 04GH}]{stacks-project}}]
%     \label{thm:finite-etale-over-strictly-henselian-splits}
%     \uses{def:strictly-henselian-local-ring}
%     Let \(A\) be a strictly henselian local ring. Then every étale ring map \(A \to B\) splits as \(B \cong A \times \cdots \times A\) for finitely many copies of \(A\).
% \end{proposition}

% \begin{proof}
%   Let $\m$ be the maximal ideal of $A$. Now $B/\m B$ is an \'etale algebra over the separably closed field $k = A/\m$. Since étale algebras over separably closed fields split, we have $B/\m B \cong k \times \cdots \times k$ for finitely many copies of $k$. Lifting this decomposition to $B$, we obtain $B \cong A \times \cdots \times A$ for finitely many copies of $A$. TBA.
% \end{proof}

% \begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/04GH}{Tag 04GH}]{stacks-project}}]
%     \label{thm:etale-over-strictly-henselian-splits}
%     \uses{def:strictly-henselian-local-ring}
%     Let \(A\) be a strictly henselian local ring. Then every étale ring map \(A \to B\) splits as \(B \cong A \times \cdots \times A\) for finitely many copies of \(A\).
% \end{proposition}

% \begin{proof}
%   \uses{thm:finite-etale-over-strictly-henselian-splits}
%   Let $\m$ be the maximal ideal of $A$. Now $B/\m B$ is an \'etale algebra over the separably closed field $k = A/\m$. Since étale algebras over separably closed fields split, we have $B/\m B \cong k \times \cdots \times k$ for finitely many copies of $k$. Lifting this decomposition to $B$, we obtain $B \cong A \times \cdots \times A$ for finitely many copies of $A$. TBA.
% \end{proof}

\section{Ind-etale and weakly etale ring maps}

\begin{definition}[Ind-étale algebras, {\cite[\href{https://stacks.math.columbia.edu/tag/097I}{Tag 097I}]{stacks-project}}]
    An $R$-algebra $S$ is \emph{ind-étale} if it is a filtered colimit of étale $R$-algebras.
    We say a ring homomorphism $R \to S$ is \emph{ind-étale} if $S$ is ind-étale as an $R$-algebra via $f$.
    \label{def:ind-etale}
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0BSI}{Tag 0BSI}]{stacks-project}}]
  \label{thm:ind-etale-comp}
  \uses{def:ind-etale}
  Let $A \to B$ and $B \to C$ be ring maps. If $A \to B$ and $B \to C$ are ind-étale, then $A \to C$ is ind-étale.
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0BSH}{Tag 0BSH}]{stacks-project}}]
  \label{thm:ind-etale-base-change}
  \uses{def:ind-etale}
  Let $A \to B$ be an ind-étale ring map. For any ring map $A \to C$, the base change $C \to B \otimes_A C$ is ind-étale.
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\section{w-local spaces}

\begin{definition}[w-local spaces, {\cite[Definition 2.1.1]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/096A}{Tag 096A}]{stacks-project}}]
    \label{def:w-local-space}
    \lean{WLocalSpace}
    \leanok
    % Stacks uses another definition, split is a property. Every point of X specializes to a unique closed point. This is better.
    % To be modified.
    A topological space \(X\) is \emph{w-local} if it satisfies:
    \begin{enumerate}
        \item \(X\) is spectral,
        \item every point specializes to a unique closed point,
        \item the subspace \(X^c\) of closed points is closed.
    \end{enumerate}
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0968}{Tag 0968}]{stacks-project}}]
    Let $X$ be w-local. Then every open covering of $X$ can be refined
    by a finite disjoint union decomposition $X = \coprod U_i$ with $U_i$ open and closed in $X$.
\end{lemma}

\begin{definition}[w-local morphisms, {\cite[Definition 2.1.1]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/096A}{Tag 096A}]{stacks-project}}]
    Let \(X\) and \(Y\) be w-local spaces. A morphism \(f: X \to Y\) is \emph{w-local} if it is spectral and the image of closed points \(f(X^c) \subseteq Y^c\).
    \label{def:w-local-space-map}
    \uses{def:w-local-space}
    \lean{IsWLocalMap}
    \leanok
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/096C}{Tag 096C}]{stacks-project}}]
Let $X$ be a spectral space. Let
\[
\begin{tikzcd}
Y \arrow[r] \arrow[d] & T \arrow[d] \\
X \arrow[r] & \pi_0(X)
\end{tikzcd}
\]
be a cartesian diagram in the category of topological spaces with $T$ profinite. Then $Y$ is spectral and $T = \pi_0(Y)$. If moreover $X$ is w-local, then $Y$ is w-local, $Y \to X$ is w-local, and the set of closed points of $Y$ is the inverse image of the set of closed points of $X$.
\label{thm:cartesian-w-local}
\uses{def:w-local-space,def:w-local-space-map}
\end{lemma}

\begin{proof}
  TBA.
\end{proof}

\section{w-local rings}

\begin{definition}[w-local rings, {\cite[Definition 2.2.1(i)]{proetale}}]
    A ring \(A\) is \emph{w-local} if Spec(A) is w-local.
    \label{def:w-local-ring}
    \uses{def:w-local-space}
    \lean{WLocalRing}
    \leanok
\end{definition}

\begin{definition}[w-local ring maps, {\cite[Definition 2.2.1(iii)]{proetale}}]
    A ring map \(f: A \to B\) between w-local rings is \emph{w-local} if the induced map of w-local spaces \(\Spec(f) : \Spec(B) \to \Spec(A)\) is w-local.
    % Spectral is automatic, only sending closed pts to closed pts matters.
    \label{def:w-local-ring-map}
    \uses{def:w-local-ring, def:w-local-space, def:w-local-space-map}
    %\lean{IsWLocalRingMap}
    %\leanok
\end{definition}

\begin{lemma}% To be modified.
  \label{thm:w-local-jacobson-radical}
  \uses{def:w-local-ring}
  Let $A$ be a w-local ring. The Jacobson radical \(I\) of \(A\) cuts out the closed points \(\Spec(A)^c\) of \(\Spec(A)\).
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097A}{Tag 097A}]{stacks-project}}]
\label{thm:closed-points-isom-w-local}
\uses{def:w-local-ring,def:w-local-ring-map,def:ind-Zariski}
Let $A$ be a w-local ring. Let $I \subset A$ be the radical ideal cutting out the set $X^c$ of closed points in $X = \Spec (A)$.
Let $A \to B$ be a ring map inducing algebraic extensions on residue fields at primes. Then
\begin{enumerate}
    \item every point of $Z = V(IB)$ is a closed point of $\Spec (B)$,
    \item there exists an ind-Zariski ring map $B \to C$ such that
    \begin{enumerate}
        \item $B/IB \to C/IC$ is an isomorphism, \label{item:quotinet-isom-closed-points-isom-w-local} % thus surjective on closed points
        \item $C$ is w-local, \label{item:w-local-closed-points-isom-w-local}
        \item the map $p: Y = \Spec (C) \to X$ induced by the ring map $A \to B \to C$ is w-local, and % this is not needed?
        \item $p^{-1}(X^c)$ is the set of closed points of $Y$. \label{item:inverse-image-closed-points-isom-w-local}
    \end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
  TBA.
\end{proof}


\begin{definition}[w-strictly local rings, {\cite[Definition 2.2.1(ii)]{proetale}}]
    A ring \(A\) is \emph{w-strictly local} if \(A\) is w-local, and every local ring of \(A\) at a maximal ideal is strictly henselian.
    % TODO: every faithfully flat \'etale map \(A \to B\) has a retraction. this should be a property.
    \label{def:w-strictly-local-ring}
    \uses{def:w-local-ring,def:strictly-henselian-local-ring}
    % refactor WStrictlyLocalRing, using the definition of strictly henselian
    % \lean{WStrictlyLocalRing}
    % \leanok
\end{definition}

\begin{lemma}
  \label{thm:ind-etale-strictly-henselian-identifies-local-rings}
  \uses{def:ind-etale,def:strictly-henselian-local-ring,def:identify-local-rings}
  Let \(A\) be a strictly henselian local ring. Let \(A \to B\) be an ind-étale ring map. Then \(A \to B\) identifies local rings, i.e., for every prime \(\mathfrak{q} \subset B\) the canonical map \(A_{\varphi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}\) is an isomorphism.
\end{lemma}

\begin{proof}
  % \uses{thm:etale-over-strictly-henselian-splits}
  % Let $\m$ be a maximal ideal of $B$ and $B = \colim_i A_i$ a presentation of $B$ with each $A_i$ \'etale over $A$. Since $B_q = \colim_i (A_i)_{q_i}$ where $q_i$ is the inverse image of $q$ in $A_i$, we may assume $B$ is \'etale. The it follows from \Cref{thm:etale-over-strictly-henselian-splits}. 
  WRONG, TBA.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/096U}{Tag 096U}]{stacks-project}}]
    Let $A$ be a ring. There exists a faithfully flat, ind-Zariski map $A \to A_{w}$ such
    that $A_w$ is w-local and the closed points of $\spec{A_w}$ surject onto $\spec{A}$.
    \label{prop:exists-ind-zariski-w-local}
\end{proposition}

\begin{proof}
    TBA
\end{proof}

\begin{lemma}
    Let $A$ be a ring such that every faithfully flat étale ring map $A \to B$ has
    a retraction. Then every local ring of $A$ at a maximal ideal is strictly henselian.
    \label{lemma:retractions-strictly-henselian}
\end{lemma}

\begin{proof}
    TBA
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/097R}{Tag 097R}]{stacks-project}}]
    Let $A$ be a ring. Then there exists an ind-étale faithfully flat $A$-algebra $B$ such that
    every faithfully flat étale ring map $B \to C$ has a retraction.
    \label{prop:exists-ind-etale-retraction-etale}
\end{proposition}

\begin{proof}
    TBA
\end{proof}

\begin{lemma}
    Let $k$ be a field and $A$ an ind-étale, local $k$-algebra. Then $A$ is
    a separable algebraic field extension of $k$.
    \label{lemma:field-local-indetale}
\end{lemma}

\begin{proof}
    Let $A = \colim_i A_i$ such that $A_i$ is an étale $k$-algebra for all $i$.
    Let $\mathfrak{m}$ be the maximal ideal of $A$. Since localization commutes with colimits,
    we obtain $A = A_{\mathfrak{m}} = \colim_i (A_i)_{\mathfrak{m}_i}$ where
    $\mathfrak{m}_i$ is the restriction of $\mathfrak{m}$ to $A_i$. Since $A_i$ is étale over $k$,
    it is a finite product of finite separable extensions of $k$, hence $(A_i)_{\mathfrak{m}_i}$
    is a finite separable extension of $k$. Since a colimit of finite separable
    extensions is an algebraic separable extension, we conclude.
\end{proof}

\begin{proposition}
    Let $f\colon A \to B$ be ind-étale. Then $f$ induces separable algebraic extensions on residue fields.
    \label{prop:ind-etale-residue-fields}
\end{proposition}

\begin{proof}
    Let $\mathfrak{p}$ be a prime ideal of $B$. After base change along $A \to \kappa(\mathfrak{p}^c)$,
    we may assume $A = k$ is a field. After postcomposing with the ind-étale map $B \to B_{\mathfrak{p}}$,
    we may assume $B$ is local. Hence the result follows from \ref{lemma:field-local-indetale}.
\end{proof}

\begin{lemma}
    Let $A \to B$ be a faithfully flat ring map and $I \subseteq A$ an ideal.
    Then $V(IB)$ surjects onto $V(I)$.
    \label{lemma:faithfully-flat-surject-closed}
\end{lemma}

\begin{proof}
    We have $B / I B \cong A / I \otimes_A B$. Since faithfully flat is stable under base change,
    $A / I \to B / IB$ is faithfully flat. Hence $\spec{B / IB} \to \spec{A / I}$ is surjective
    and the claim follows.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/097X}{Tag 097X}]{stacks-project}}]
    For any ring \(A\), there exists an ind-étale faithfully flat \(A\)-algebra \(B\) with \(B\) w-strictly local.
    \label{thm:ind-etale-w-strictly-local-cover}
    \uses{def:w-strictly-local-ring,def:ind-etale, prop:exists-ind-zariski-w-local}
\end{proposition}

\begin{proof}
    By \ref{prop:exists-ind-zariski-w-local}, there exists a faithfully flat, ind-Zariski map
    $A \to A'$ such that $A'$ is w-local and the set of closed points of $\spec{A'}$ surjects
    onto $\spec{A}$. Since $A'$ is w-local, the set of closed points of $\spec{A'}$ is closed.
    Let $I$ be the radical ideal of $A'$ such that $V(I)$ is the set of closed points of $\spec{A'}$.
    Choose an ind-étale and faithfully flat ring map $A' \to B'$ as in
    \ref{prop:exists-ind-etale-retraction-etale}. By
    \ref{lemma:retractions-strictly-henselian}, the local ring $B'_{\mathfrak{m}'}$ is
    strictly henselian for every maximal ideal $\mathfrak{m}'$ of $B'$.
    The map $A \to A'$ induces algebraic extensions on residue fields at primes by
    \ref{prop:ind-etale-residue-fields},
    so applying \ref{thm:closed-points-isom-w-local} to $A' \to B'$, we obtain
    an ind-Zariski ring map $B' \to B$ such that $B'/IB' \to B/IB$ is an isomorphism,
    $V(IB)$ is the set of closed points of $\spec{B}$ and $B$ is w-local.

    It remains to verify that the composition $A \to A' \to B' \to B$ is ind-étale and faithfully flat.
    The first one follows because being ind-étale is stable under composition. For the second
    one it suffices to show that $\spec{B} \to \spec{B'} \to \spec{A'} \to \spec{A}$ is surjective.
    Since the closed points of $\spec{A'}$ surject onto $\spec{A}$ and $B' / IB' \cong B / I B$, it
    suffices to check that $V(IB')$ surjects onto $V(I)$. This is \ref{lemma:faithfully-flat-surject-closed}.
\end{proof}

\section{ind-Zariski maps}

\begin{definition}[Ind-(Zariski localizations), {\cite[\href{https://stacks.math.columbia.edu/tag/096N}{Tag 096N}]{stacks-project}}]
    \label{def:ind-Zariski}

    An $R$-algebra $S$ is called a \emph{ind-Zariski} if $S$ can be written as a filtered colimit $S \simeq \colim S_i$ with each $R \to S_i$ a local isomorphism. A ring homomorphism $f : R \to S$ is called a \emph{ind-Zariski localization} if $S$ is ind-Zariski localization as an $R$-algebra via $f$.

    \uses{def:local-isomorphism}
\end{definition}

\begin{remark}
  The definition of ind-Zariski is slightly more general from \cite[Definition 2.2.1(iv)]{proetale}, where they defined as a filtered colimit of finite products of principal localizations. 
\end{remark}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/096T}{Tag 096T}]{stacks-project}}]
  Let $A \to B$ be an ind-Zariski ring map. Then it identifies local rings, i.e. for every prime $\mathfrak{q} \subset B$ the canonical map $A_{\varphi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}$ is an isomorphism.
  \label{thm:ind-Zariski-identifies-local-rings}
  \uses{def:ind-Zariski,def:identify-local-rings}
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}
  Let $A \to B$ be an ind-Zariski ring map. Then $A \to B$ is flat and ind-étale.
  \label{thm:ind-Zariski-is-flat-ind-etale}
  \uses{def:ind-Zariski,def:ind-etale}
\end{lemma}

\begin{proof}
  An ind-Zariski ring map is a filtered colimit of local isomorphisms. A local isomorphism is flat and étale.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097D}{Tag 097D}]{stacks-project}}]
Let $A$ be a ring and let $X = \Spec (A)$. Let $T$ be a profinite space and let $T \to \pi_0(X)$ be a continuous map. There exists an ind-Zariski ring map $A \to B$ such that with $Y = \Spec (B)$ the diagram
\[
\begin{tikzcd}
Y \arrow[r] \arrow[d] & \pi_0(Y) \arrow[d] \\
X \arrow[r] & \pi_0(X)
\end{tikzcd}
\]
is cartesian in the category of topological spaces and such that $\pi_0(Y) = T$ as spaces over $\pi_0(X)$.
\label{thm:exists-ind-Zariski-cartesian}
\uses{def:ind-Zariski}
\end{lemma}

\begin{proof}
  TBA
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/09AZ}{Tag 09AZ}, (3) $\implies$ (1)]{stacks-project}}]
  \label{thm:ff-identifies-local-rings-has-retraction-if}
  \uses{def:w-local-ring,def:extremally-disconnected,def:identify-local-rings}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-local, and
    \item $\pi_0(\operatorname{Spec}(A))$ is extremally disconnected.
  \end{enumerate}
  Then every faithfully flat ring map $A \to B$ identifying local rings has a retraction.
\end{proposition}

\begin{proof}
  TBA.
\end{proof}

\section{w-contractible rings}

\begin{definition}[w-contractible rings, {\cite[Definition 2.4.1]{proetale}}]
A ring \(A\) is \emph{w-contractible} if every faithfully flat ind-étale map \(A \to B\) has a retraction.
  \label{def:w-contractible-ring}
\end{definition}

\begin{lemma}
  \label{thm:w-contractible-if-ind-etale-plus-c-has-retraction}
  \uses{def:w-local-ring,def:ind-etale,def:w-contractible-ring}
  Let \(A\) be a w-local ring and $I \subset A$ the Jacobson radical cutting out the set $X^c$ of closed points in $X = \Spec (A)$. If every faithfully flat ind-étale map \(A \to B\) with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\) has a retraction, then \(A\) is w-strictly contractible.
\end{lemma}

\begin{proof}
  \uses{thm:closed-points-isom-w-local,thm:ind-Zariski-is-flat-ind-etale,thm:ind-etale-comp}
  Let $A \to B$ be faithfully flat and ind-étale. 
  % We will use without further mention the fact that a flat map $A \to B$ is faithfully flat if and only if every closed point of $\operatorname{Spec}(A)$ is in the image of $\operatorname{Spec}(B) \to \operatorname{Spec}(A)$. 
  We will show that $A \to B$ has a retraction.

  We may replace $B$ by the ring $C$ constructed in \Cref{thm:closed-points-isom-w-local} for $A \to B$ and $I \subset A$. To justify this, note that by \Cref{thm:ind-Zariski-is-flat-ind-etale}, the map \( B \to C \) is flat and ind-étale. It is faithfully flat by \Cref{item:quotinet-isom-closed-points-isom-w-local} in \Cref{thm:closed-points-isom-w-local}, since the closed points of \( \Spec(B) \) lie in the image of \( \Spec(C) \to \Spec(B) \). Therefore, by \Cref{thm:ind-etale-comp}, the composition \( A \to C \) is also faithfully flat and ind-étale. Hence, we may assume $\Spec (B)$ is w-local such that the set of closed points of $\Spec (B)$ is $V(IB)$ by \Cref{item:w-local-closed-points-isom-w-local,item:inverse-image-closed-points-isom-w-local} in \Cref{thm:closed-points-isom-w-local}.
\end{proof}

\begin{lemma}
  \label{thm:ind-etale-plus-c-has-retraction-if}
  \uses{def:w-strictly-local-ring,def:extremally-disconnected,def:ind-etale}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-strictly local, and \label{item:w-strictly-local-ind-etale-plus-c-has-retraction-if}
    \item $\pi_0(\Spec (A))$ is extremally disconnected. \label{item:extremally-disconnected-ind-etale-plus-c-has-retraction-if}
  \end{enumerate}
  then every faithfully flat ind-étale map \(A \to B\) with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\) has a retraction. Here $I \subset A$ is the Jacobson radical of $A$ cutting out the set $X^c$ of closed points in $X = \Spec (A)$.
\end{lemma}

\begin{proof}
  \uses{thm:ind-etale-base-change,thm:ind-etale-strictly-henselian-identifies-local-rings,thm:ff-identifies-local-rings-has-retraction-if}
  Let \(A \to B\) be a faithfully flat ind-étale map with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\). In this case $A \to B$ identifies local rings, it suffices to check this at maximal ideals of $B$ which lie over maximal ideals of $A$. By \Cref{item:w-strictly-local-ind-etale-plus-c-has-retraction-if}, we know that the local rings of $A$ at its maximal ideal $\m$ are strictly henselian. By \Cref{thm:ind-etale-base-change} and \Cref{thm:ind-etale-strictly-henselian-identifies-local-rings}.
  Thus $A \to B$ has a retraction by \Cref{thm:ff-identifies-local-rings-has-retraction-if}.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/0982}{Tag 0982}, (3) $\implies$ (2)]{stacks-project}}] % actually iff, but we only need this direction
  \label{thm:w-contractible-if}
  \uses{def:w-contractible-ring,def:w-strictly-local-ring,def:extremally-disconnected}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-strictly local, and
    \item $\pi_0(\Spec (A))$ is extremally disconnected.
  \end{enumerate}
  then $A$ is w-contractible.
\end{proposition}

\begin{proof}
  \uses{thm:w-contractible-if-ind-etale-plus-c-has-retraction,thm:ind-etale-plus-c-has-retraction-if}
  This is \Cref{thm:ind-etale-plus-c-has-retraction-if} with \Cref{thm:w-contractible-if-ind-etale-plus-c-has-retraction}.
  % Assume (1) or equivalently (2). We have (3)(c) by Lemma \ref{lemma:097V}. Properties (3)(a) and (3)(b) follow from Lemma \ref{lemma:09AZ}.
\end{proof}
  

\begin{lemma}
  If a ring \(C\) is w-strictly local, then there exists an ind-étale faithfully flat \(C\)-algebra \(D\) with \(D\) w-contractible.
  \label{thm:ind-etale-w-contractible-cover-of-w-strictly-local}
  \uses{def:w-contractible-ring,def:w-strictly-local-ring,def:ind-etale}
\end{lemma}

\begin{proof}
  % The proof goes as in https://stacks.math.columbia.edu/tag/0983, starting from the second sentence.
  \uses{thm:extremally-disconnected-cover,thm:exists-ind-Zariski-cartesian,thm:cartesian-w-local,thm:ind-Zariski-identifies-local-rings,thm:w-contractible-if}
  Choose an extremally disconnected space $T$ and a surjective continuous map $T \to \pi_0(\operatorname{Spec}(C))$ by \Cref{thm:extremally-disconnected-cover}. Note that $T$ is profinite.
  Apply \Cref{thm:exists-ind-Zariski-cartesian} to find an ind-Zariski ring map $C \to D$ such that $\pi_0(\Spec (D)) \to \pi_0(\Spec (C))$ realizes $T \to \pi_0(\Spec (C))$ and such that
  \[
  \begin{tikzcd}
  \operatorname{Spec}(D) \arrow[r] \arrow[d] & \pi_0(\operatorname{Spec}(D)) \arrow[d] \\
  \operatorname{Spec}(C) \arrow[r] & \pi_0(\operatorname{Spec}(C))
  \end{tikzcd}
  \]
  is cartesian in the category of topological spaces.

  Following \Cref{thm:cartesian-w-local}, we note that $\Spec (D)$ is w-local, that $\Spec (D) \to \Spec (C)$ is w-local, and that the set of closed points of $\Spec (D)$ is the inverse image of the set of closed points of $\Spec (C)$.

  Thus it is still true that the local rings of $D$ at its maximal ideals are strictly henselian (as they are isomorphic to the local rings at the corresponding maximal ideals of $C$ by \Cref{thm:ind-Zariski-identifies-local-rings}). It follows from \Cref{thm:w-contractible-if} that $D$ is w-contractible.
\end{proof}

\begin{theorem}[{\cite[Theorem 2.4.9]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/0983}{Tag 0983}]{stacks-project}}]
  For any ring $A$, there exists an ind-étale faithfully flat $A$-algebra $D$ with $D$ w-contractible.

  \label{thm:ind-etale-w-contractible-cover-exists}
  \uses{def:w-contractible-ring,def:ind-etale}
\end{theorem}

\begin{proof}
  \uses{thm:ind-etale-w-strictly-local-cover,thm:ind-etale-w-contractible-cover-of-w-strictly-local}
  This is a combination of \Cref{thm:ind-etale-w-strictly-local-cover} and \Cref{thm:ind-etale-w-contractible-cover-of-w-strictly-local}.
\end{proof}
