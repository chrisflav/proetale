\chapter{Local structure}

This chapter serves for the commutative algebra preparation of the remaining part of the paper. The key results are
\begin{enumerate}
  \item \Cref{thm:ind-etale-w-contractible-cover-exists} expressing that every affine scheme has a w-contractible cover in the proetale site.
  \item \Cref{thm:weakly-etale-ind-etale} expressing that every weakly etale map can be covered by ind-etale maps.
\end{enumerate}

% Question: Can we avoid using weakly etale algebra, only use ind-etale algebra? This would need a modification of theorem 5.4.2, by directly mimicking the proof of topological invariance of étale sites for weakly étale.
% If so, we can remove theorem \Cref{thm:weakly-etale-ind-etale} and every dependency of it.
\section{Preliminaries}

\begin{definition}[Extremally disconnected space]
  \label{def:extremally-disconnected}
  \lean{ExtremallyDisconnected}
  \mathlibok

  A topological space \(X\) is \emph{extremally disconnected} if the closure of every open subset is open.
\end{definition}

The reason that we are interested in extremally disconnected space is the following theorem.

\begin{theorem}
  \label{thm:extremally-disconnected-projective}
  \uses{def:extremally-disconnected}
  \lean{CompHaus.toStonean,Stonean.instProjectiveCompHausCompHaus}
  \mathlibok
  Let \(X\) be a compact Hausdorff topological space. Then \(X\) is extremally disconnected if and only if it is a projective object in the category of compact Hausdorff spaces, i.e., for every continuous surjection \(f : Y \to Z\) of compact Hausdorff spaces and every continuous map \(g : X \to Z\), there exists a continuous map \(h : X \to Y\) such that \(f \circ h = g\).
\end{theorem}

\begin{definition} [Stone-Čech compactification]
  \label{def:stone-cech-compactification}
  \lean{StoneCech}
  \mathlibok

  Let \(X\) be a topological space. The \emph{Stone-Čech compactification} of \(X\) is the
  profinite space \(\beta(X)\) such that
  \begin{enumerate}
    \item \(X\) is dense in \(\beta(X)\);
    \item every continuous map \(f: X \to Y\) to a compact Hausdorff space \(Y\)
        extends uniquely to a continuous map \(\beta(f): \beta(X) \to Y\).
  \end{enumerate}
  We denote the Stone-Čech compactification of \(X\) by \(\beta(X)\).
\end{definition}

\begin{theorem}
    Let \(X\) be a topological space. Then the Stone-Čech compactification \(\beta(X)\) is extremally disconnected.
    \label{thm:stone-cech-extremally-disconnected}
    \uses{def:extremally-disconnected, def:stone-cech-compactification}
    \lean{StoneCech.projective}
    \mathlibok
\end{theorem}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/090D}{Tag 090D}]{stacks-project}}]
  Let $X$ be a quasi-compact Hausdorff space. There exists a continuous surjection $X' \to X$ with $X'$ quasi-compact, Hausdorff, and extremally disconnected.
  \label{thm:extremally-disconnected-cover}
  \uses{def:extremally-disconnected, def:stone-cech-compactification}
\end{proposition}

\begin{proof}
  \uses{thm:stone-cech-extremally-disconnected}
  Let $Y=X$ but endowed with the discrete topology. Let $X'=\beta (Y)$, which is extremally disconnected by \Cref{thm:stone-cech-extremally-disconnected}. The continuous map $Y \to X$ factors as $Y \to X' \to X$.
\end{proof}

The following pure topological lemmas will be used in \Cref{thm:colim-open-closed-localizations-surj-ind-zariski}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/005F}{Tag 005F}]{stacks-project}}]
  \label{thm:connected-component-intersection-closed-open}
  Let $X$ be a topological space. Assume
  \begin{enumerate}
    \item $X$ is quasi-compact,
    \item $X$ has a basis for the topology consisting of quasi-compact opens, and
    \item the intersection of two quasi-compact opens is quasi-compact.
  \end{enumerate}
  For any $x \in X$ the connected component of $X$ containing $x$ is the intersection of all open and closed subsets of $X$ containing $x$.
\end{lemma}

\begin{proof}
  Let $T$ be the connected component containing $x$. Let $S = \bigcap_{\alpha \in A} Z_\alpha$ be the intersection of all open and closed subsets $Z_\alpha$ of $X$ containing $x$. Note that $S$ is closed in $X$. Note that any finite intersection of $Z_\alpha$'s is a $Z_\alpha$. Because $T$ is connected and $x \in T$ we have $T \subset Z_\alpha$ for every \(Z_\alpha\), thus \(T \subset S\). It suffices to show that $S$ is connected. If not, then there exists a disjoint union decomposition $S = B \amalg C$ with $B$ and $C$ open and closed in $S$. In particular, $B$ and $C$ are closed in $X$, and so quasi-compact by assumption (1). By assumption (2) there exist quasi-compact opens $U, V \subset X$ with $B = S \cap U$ and $C = S \cap V$. Then $U \cap V \cap S = \emptyset$. Hence $\bigcap_\alpha U \cap V \cap Z_\alpha = \emptyset$. By assumption (3) the intersection $U \cap V$ is quasi-compact. Hence for some $\alpha' \in A$ we have $U \cap V \cap Z_{\alpha'} = \emptyset$. Since $X \setminus (U \cup V)$ is disjoint from $S$ and closed in $X$ hence quasi-compact, we can use the same argument to see that $Z_{\alpha''} \subset U \cup V$ for some $\alpha'' \in A$. Then $Z_\alpha = Z_{\alpha'} \cap Z_{\alpha''}$ is contained in $U \cup V$ and disjoint from $U \cap V$. Hence $Z_\alpha = U \cap Z_\alpha \amalg V \cap Z_\alpha$ is a decomposition into two open pieces, hence $U \cap Z_\alpha$ and $V \cap Z_\alpha$ are open and closed in $X$. Thus, if $x \in B$ say, then we see that $S \subset U \cap Z_\alpha$ and we conclude that $C = \emptyset$.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/04PL}{Tag 04PL}]{stacks-project}}]
  \label{thm:intersection-closed-open-iff} % This is spectral minus sober, we only need X spectral version.
  Let $X$ be a topological space. Assume
  \begin{enumerate}
    \item $X$ is quasi-compact,
    \item $X$ has a basis for the topology consisting of quasi-compact opens, and
    \item the intersection of two quasi-compact opens is quasi-compact.
  \end{enumerate}
  For a subset $T \subset X$ the following are equivalent:
  \begin{enumerate}
    \item $T$ is an intersection of open and closed subsets of $X$, and
    \item $T$ is closed in $X$ and is a union of connected components of $X$.
  \end{enumerate}
\end{lemma}

\begin{proof}
  \uses{thm:connected-component-intersection-closed-open}
  It is clear that (a) implies (b). Assume (b). Let $x \in X$, $x \notin T$. Let $x \in C \subset X$ be the connected component of $X$ containing $x$. By \Cref{thm:connected-component-intersection-closed-open} we see that $C = \bigcap V_\alpha$ is the intersection of all open and closed subsets $V_\alpha$ of $X$ which contain $C$. In particular, any pairwise intersection $V_\alpha \cap V_\beta$ occurs as a $V_\alpha$ i.e. is still open and closed. As $T$ is a union of connected components of $X$ we see that $C \cap T = \emptyset$. Hence $T \cap \bigcap V_\alpha = \emptyset$. Since $T$ is quasi-compact as a closed subset of a quasi-compact space, we deduce that $T \cap V_\alpha = \emptyset$ for some $\alpha$. For this $\alpha$ we see that $U_\alpha = X \setminus V_\alpha$ is an open and closed subset of $X$ which contains $T$ and not $x$. The lemma follows.
\end{proof}

\begin{definition}[Local isomorphisms, {\cite[\href{https://stacks.math.columbia.edu/tag/096E}{Tag 096E} (1)]{stacks-project}}]
  \label{def:local-isomorphism}
  We say $A \to B$ is a \emph{local isomorphism} if for every prime $\mathfrak{q} \subset B$ there exists a $g \in B$, $g \notin \mathfrak{q}$ such that $A \to B_g$ induces an open immersion $\Spec (B_g) \to \Spec (A)$.
\end{definition}

\begin{definition}[Identify local rings, {\cite[\href{https://stacks.math.columbia.edu/tag/096E}{Tag 096E} (2)]{stacks-project}}]
  A ring map $A \to B$ \emph{identifies local rings} if for every prime $\mathfrak{q} \subset B$ the canonical map $A_{\varphi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}$ is an isomorphism.
  \label{def:identify-local-rings}
\end{definition}

\begin{lemma}
  \label{thm:identifies-local-rings-composition}
  Let \(A \to B\) and \(B \to C\) be ring maps that identify local rings. Then the composition \(A \to C\) also identifies local rings.
  \uses{def:identify-local-rings}
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}
    Let $A = \colim_i A_i$ be a filtered colimit of $A$-algebras and let $B$ be an étale $A$-algebra. Then
    there exists an $i$ and an étale $A_i$-algebra $B'$ such that
    \[
    \begin{tikzcd}
        A_i \arrow{r} \arrow{d} & B' \arrow{d} \\
        A \arrow{r} & B
    \end{tikzcd}
    \] is a pushout diagram.
    \label{lemma:etale-ind-spreads}
\end{lemma}

\begin{proof}
    This follows because every étale algebra is of finite presentation and by possibly enlarging $i$ we can ensure
    that $B'$ is étale over $A_i$.
\end{proof}

\section{ind-Zariski maps}

\begin{definition}[Ind-Zariski, {\cite[\href{https://stacks.math.columbia.edu/tag/096N}{Tag 096N}]{stacks-project}}]
    \label{def:ind-Zariski}
    \uses{def:local-isomorphism}
    An $R$-algebra $S$ is called a \emph{ind-Zariski} if $S$ can be written as a filtered colimit $S \simeq \colim S_i$ with each $R \to S_i$ a local isomorphism. A ring homomorphism $f : R \to S$ is called a \emph{ind-Zariski} if $S$ is ind-Zariski as an $R$-algebra via $f$.
\end{definition}

\begin{remark}
  The definition of ind-Zariski is slightly more general from \cite[Definition 2.2.1(iv)]{proetale}, where they defined as a filtered colimit of finite products of principal localizations.
\end{remark}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/096T}{Tag 096T}]{stacks-project}}]
  Let $A \to B$ be an ind-Zariski ring map. Then it identifies local rings, i.e. for every prime $\mathfrak{q} \subset B$ the canonical map $A_{\varphi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}$ is an isomorphism.
  \label{thm:ind-Zariski-identifies-local-rings}
  \uses{def:ind-Zariski,def:identify-local-rings}
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}
  Let $A \to B$ be an ind-Zariski ring map. Then $A \to B$ is flat and ind-étale.
  \label{thm:ind-Zariski-is-flat-ind-etale}
  \uses{def:ind-Zariski,def:ind-etale}
\end{lemma}

\begin{proof}
  An ind-Zariski ring map is a filtered colimit of local isomorphisms. A local isomorphism is flat and étale.
\end{proof}

\begin{lemma}
    A filtered colimit of ind-Zariski algebras is ind-Zariski.
    \label{lemma:ind-ind-Zariski}
  \uses{def:ind-Zariski}
\end{lemma}

\begin{proof}
    This follows from general theory, because local isomorphisms are of finite presentation.
\end{proof}

\begin{lemma}
    A finite product of ind-Zariski algebras is ind-Zariski.
    \label{lemma:ind-Zariski-products}
    \uses{def:ind-Zariski}
\end{lemma}

\begin{proof}
    TBA.
\end{proof}

\section{Henselian objects and Henselisation}

In this section we define a generalisation of the notion of a Henselian ring to an arbitrary category. Let $\mathcal{C}$ be a category
and $P$ a property of morphisms.

\begin{definition}[Henselian]
    A morphism $f\colon X \to Y$ is $P$-\emph{Henselian}, if for every factorisation
    \[
    \begin{tikzcd}
        X \arrow{r}{u} \arrow[swap]{dr}{f} & Z \arrow{d}{v} \\
                    & Y,
    \end{tikzcd}
    \] with $u$ satisfying $P$, there exists a retraction of $u$.
\end{definition}

\begin{example}
    A local ring $(R, \mathfrak{m}, \kappa)$ is Henselian if and only if the projection $R \to \kappa$ is étale-Henselian.
\end{example}

\begin{proof}
    By {\cite[\href{https://stacks.math.columbia.edu/tag/04GG}{Tag 04GG}]{stacks-project}}, $R$ is Henselian if and only if
    for any étale ring map $R \to S$ and prime $\mathfrak{q}$ of $S$ lying over $\mathfrak{m}$ with $\kappa = \kappa(\mathfrak{q})$,
    there exists a retraction $S \to R$ of $R \to S$.

    Suppose $R$ is Henselian and let $R \to S \to \kappa$ be a factorisation of $R \to \kappa$ with $R \to S$ étale. Then
    $\mathfrak{q} = \mathrm{ker}(S \to \kappa)$ is a prime ideal of $S$ lying above $\mathfrak{m}$. Hence we obtain a commutative
    diagram
    \[
        \begin{tikzcd}
        R \arrow{r} \arrow{d} & S \arrow{r} \arrow{d} & \kappa \\
        \kappa \arrow[dashed]{r} & \kappa(\mathfrak{q}) \arrow[dashed]{ur},
        \end{tikzcd}
    \] where the composition of the dashed arrows is the identity of $\kappa$. Hence $\kappa(\mathfrak{q}) = \kappa$ and by assumption,
    $R \to S$ has a retraction.

    Now assume that $R \to \kappa$ is étale-Henselian and let $R \to S$ be étale and $\mathfrak{q}$ be a prime ideal of $S$ with
    $\kappa(\mathfrak{q}) = \kappa$. Hence the composition $R \to S \to \kappa(\mathfrak{q}) = \kappa$ is a factorisation
    of $R \to \kappa$. Thus $R \to S$ has a retraction.
\end{proof}

% TODO: add definition of Henselisation if needed

\begin{definition}[Strictly Henselian local ring]
    \label{def:strictly-henselian-local-ring}
    A local ring $(R, \mathfrak{m}, \kappa)$ is \emph{strictly henselian} if the composition $R \to \kappa \to \kappa^{\mathrm{sep}}$ is étale-Henselian
    for a separable closure $\kappa^{\mathrm{sep}}$.
\end{definition}

The following example shows that our definition agrees with the one in
\cite[\href{https://stacks.math.columbia.edu/tag/04GF}{Tag 04GF}]{stacks-project}.

\begin{example}
    A local ring $(R, \mathfrak{m}, \kappa)$ is strictly Henselian if and only if it is Henselian and $\kappa$ is separably closed.
\end{example}

\begin{lemma}
    Let $A$ be a ring and $\mathfrak{m}$ a maximal ideal of $A$. Suppose for every étale $A$-algebra $B$ and
    prime ideal $\mathfrak{q} \subseteq B$ lying over $\mathfrak{m}$, the induced map
    $A_{\mathfrak{m}} \to B_{\mathfrak{q}}$ is an isomorphism.
    Then $A_{\mathfrak{m}}$ is strictly Henselian.
    \label{lemma:localization-strictly-Henselian}
\end{lemma}

\begin{proof}
    Denote $\kappa = A / \mathfrak{m}$ and let $\kappa^{\mathrm{sep}}$ be a separable closure of $\kappa$.
    Let $A_{\mathfrak{m}} \to S \to \kappa^{\mathrm{sep}}$ be a factorisation of $A_{\mathfrak{m}} \to \kappa \to \kappa^{\mathrm{sep}}$
    with $A_{\mathfrak{m}} \to S$ étale.

    TBA
\end{proof}

\begin{proposition}
    \label{thm:strictly-henselian-good-retraction}
    \uses{def:strictly-henselian-local-ring}
    Let \(A, \m\) be a strictly henselian local ring. Let \(f : A \to B\) a \'etale ring map with \(\n\) a maximal ideal of \(B\) lying over \(\m\). Then there exists a retraction \(s : B \to A\) of \(A \to B\) such that \(\n = s^{-1}(\m)\).
\end{proposition}

\begin{proof}
  Since \(B/\m B\) is an étale algebra over the residue field \(k = A/\m\), it splits as \(B/\m B \cong k_1 \times \cdots \times k_n\) for finitely many finite separable extensions \(k_i\) of \(k\). Thus \(B/\n\), as a quotient of \(B/\m B\), is also a finite separable extension of \(k\). Choose an inclusion \(B/\n \hookrightarrow k^{\sep}\). Then we have a commutative diagram
  \[
  \begin{tikzcd}
    A \arrow{r} \arrow{d} & B \arrow{d}\arrow{rd} & \\
    k \arrow{r} & B/\n \arrow{r} & k^{\sep}.
  \end{tikzcd}
  \]
  Since \(A \to k^{\sep}\) is étale-Henselian, there exists a retraction \(r : B \to A\) of \(A \to B\). But this retraction may not satisfy \(\n = r^{-1}(\m)\). 
  
  To solve this, notice that there are only finitely many prime ideals \(\n_0 = \n, \n_1, \cdots, \n_k\) of \(B\) lying over \(\m\) and they are all maximal ideals. (directly by the fact that \(B/\m B \cong k_1 \times \cdots \times k_n\)). Since \(\bigcap_{i \ne 0} \n_i \nsubseteq \n\) (otherwise one of \(\n_i \subseteq \n\) which is impossible), we can find element \(b \in \n_i\) for every \(i \ne 0\) that does not fall in $\n$. We may replace \((B, \n)\) by \((B_b, \n B_b)\), then \(B\) is still étale over \(A\) and \(\n\) is the only prime ideal of \(B\) lying over \(\m\). Then the section \(s_b : B_b \to A\) given by the previous paragraph satisfies \(\n B_b = s_b^{-1}(\m)\). Composition with the localization map \(B \to B_b\) gives the desired section \(s : B \to A\).
\end{proof}

\begin{proposition}
    \label{thm:etale-over-strictly-henselian-localization-isom}
    \uses{def:strictly-henselian-local-ring}
    Let \(A\) be a strictly Henselian local ring and \(f : A \to B\) an étale ring map. Suppose \(\n\) is a maximal ideal of \(B\) lying over the maximal ideal \(\m\) of \(A\). Then the induced map \(A \to B_\n\) is an isomorphism.
\end{proposition}

\begin{proof}
  \uses{thm:strictly-henselian-good-retraction}
  Let \(s: B \to A\) be the section given by \Cref{thm:strictly-henselian-good-retraction} for the pair \((B, \n)\). Localizing at \(\m\), we obtain the following diagram:
  \[
  \begin{tikzcd}
    A = A_\m \arrow[r, "f_\m"]\arrow[dr, "f'"'] & B_\m \arrow[d] \arrow[r, "s_\m"] & A \\
    & B_\n \arrow[ur, dotted, "s'"'] &
  \end{tikzcd}
  \]
  The dotted arrow \(s'\) exists by the universal property of localization, since \(\n = s^{-1}(\m)\). Moreover, \(s'\) is a section of \(f'\).

  Since \(f_\m\) is étale and \(s_\m\) is a section of \(f_\m\), it follows that \(s_\m\) is also étale by the cancellation property of étale maps. Thus \(s'\), being a composition of a localization and an étale map, is flat. As a flat local ring homomorphism, \(s'\) is faithfully flat and hence injective. Since \(s'\) is also a section of \(f'\), it is surjective. Therefore, \(s'\) is an isomorphism, and the composition \(A \to B_\n\) is an isomorphism.
\end{proof}

\section{Ind-etale and weakly etale ring maps}

\begin{definition}[Ind-étale algebras, {\cite[\href{https://stacks.math.columbia.edu/tag/097I}{Tag 097I}]{stacks-project}}]
    An $R$-algebra $S$ is \emph{ind-étale} if it is a filtered colimit of étale $R$-algebras.
    We say a ring homomorphism $R \to S$ is \emph{ind-étale} if $S$ is ind-étale as an $R$-algebra via $f$.
    \label{def:ind-etale}
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0BSI}{Tag 0BSI}]{stacks-project}}]
  \label{thm:ind-etale-comp}
  \uses{def:ind-etale}
  Let $A \to B$ and $B \to C$ be ring maps. If $A \to B$ and $B \to C$ are ind-étale, then $A \to C$ is ind-étale.
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0BSH}{Tag 0BSH}]{stacks-project}}]
  \label{thm:ind-etale-base-change}
  \uses{def:ind-etale}
  Let $A \to B$ be an ind-étale ring map. For any ring map $A \to C$, the base change $C \to B \otimes_A C$ is ind-étale.
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\section{w-local spaces}

\begin{definition}[w-local spaces, {\cite[Definition 2.1.1]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/096A}{Tag 096A}]{stacks-project}}]
    \label{def:w-local-space}
    % \lean{WLocalSpace}
    % \leanok % To be modified
    A topological space \(X\) is \emph{w-local} if it satisfies:
    \begin{enumerate}
        \item \(X\) is spectral,
        \item every point specializes to a unique closed point,
        \item the subspace \(X^c\) of closed points is closed.
    \end{enumerate}
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/096B}{Tag 096B}]{stacks-project}}]
  \label{thm:closed-subspace-w-local}
  \uses{def:w-local-space,def:w-local-space-map}
  Let \(X\) be a w-local space. Then every closed subspace \(Y \subseteq X\) is w-local. Moreover, the inclusion map \(Y \to X\) is w-local.
\end{lemma}

\begin{proof}
  Every closed point of \(Y\) is a closed point in \(X\) because \(Y\) is closed under specialization. The subset \(Y_0 \subset Y\) of closed points is closed because \(Y_0 = X_0 \cap Y\). Since \(X\) is w-local, every \(y \in Y\) specializes to a unique point of \(X_0\). This specialization is in \(Y\), and hence also in \(Y_0\), because \(\overline{\{y\}} \subset Y\). In conclusion, \(Y\) is w-local and the inclusion map \(Y \to X\) is w-local.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0968}{Tag 0968}]{stacks-project}}]
    Let $X$ be a w-local space. Then every open covering of $X$ can be refined
    by a finite disjoint union decomposition $X = \coprod U_i$ with $U_i$ open and closed in $X$.
\end{lemma}

\begin{proof}
  TBA.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/0968}{Tag 0968}]{stacks-project}}]
  \label{thm:closed-points-isom-pi0}
  \uses{def:w-local-space}
  Let \(X\) be a w-local space. Then the set of closed points \(X^c\) is isomorphic to \(\pi_0(X)\).
\end{lemma}

\begin{proof}
  TBA. (0968)
\end{proof}

\begin{definition}[w-local morphisms, {\cite[Definition 2.1.1]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/096A}{Tag 096A}]{stacks-project}}]
    Let \(X\) and \(Y\) be w-local spaces. A morphism \(f: X \to Y\) is \emph{w-local} if it is spectral and the image of closed points \(f(X^c) \subseteq Y^c\).
    \label{def:w-local-space-map}
    \uses{def:w-local-space}
    \lean{IsWLocalMap}
    \leanok
\end{definition}

\begin{lemma}
  Let \(f: X \to Y\) and \(g: Y \to Z\) be w-local maps between w-local spaces. Then the composition \(g \circ f: X \to Z\) is w-local.
  \label{thm:w-local-map-composition}
  \uses{def:w-local-space, def:w-local-space-map}
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/096C}{Tag 096C}]{stacks-project}}]
Let $X$ be a spectral space. Let
\[
\begin{tikzcd}
Y \arrow[r] \arrow[d] & T \arrow[d] \\
X \arrow[r] & \pi_0(X)
\end{tikzcd}
\]
be a cartesian diagram in the category of topological spaces with $T$ profinite. Then $Y$ is spectral and $T = \pi_0(Y)$. If moreover $X$ is w-local, then $Y$ is w-local, $Y \to X$ is w-local, and the set of closed points of $Y$ is the inverse image of the set of closed points of $X$.
\label{thm:cartesian-w-local}
\uses{def:w-local-space,def:w-local-space-map}
\end{lemma}

\begin{proof}
  TBA.
\end{proof}

\section{w-local rings}

\begin{definition}[w-local rings, {\cite[Definition 2.2.1(i)]{proetale}}]
    A ring \(A\) is \emph{w-local} if Spec(A) is w-local.
    \label{def:w-local-ring}
    \uses{def:w-local-space}
    \lean{WLocalRing}
    \leanok
\end{definition}

\begin{definition}[w-local ring maps, {\cite[Definition 2.2.1(iii)]{proetale}}]
    A ring map \(f: A \to B\) between w-local rings is \emph{w-local} if the induced map of w-local spaces \(\Spec(f) : \Spec(B) \to \Spec(A)\) is w-local.
    % Spectral is automatic, only sending closed pts to closed pts matters.
    \label{def:w-local-ring-map}
    \uses{def:w-local-ring, def:w-local-space, def:w-local-space-map}
    %\lean{IsWLocalRingMap}
    %\leanok
\end{definition}

\begin{lemma}% To be modified.
  \label{thm:w-local-jacobson-radical}
  \uses{def:w-local-ring}
  Let $A$ be a w-local ring. The Jacobson radical \(I\) of \(A\) cuts out the closed points \(\Spec(A)^c\) of \(\Spec(A)\).
\end{lemma}

\begin{proof}
  Omitted.
\end{proof}

\begin{lemma}
  \label{thm:surjective-w-local-ring}
  If \(A \to B\) is a surjective ring map and \(A\) is w-local, then \(B\) is w-local.
  \uses{def:w-local-ring}
\end{lemma}

\begin{proof}
  \uses{thm:closed-subspace-w-local}
  This is \Cref{thm:closed-subspace-w-local}.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097E}{Tag 097E}]{stacks-project}}]
  \label{thm:isom-of-identifies-local-rings-w-local-isom-pi0}
  \uses{def:identify-local-rings,def:w-local-ring,def:w-local-ring-map}
  Let $A \to B$ be a w-local ring map between w-local rings such that
  \begin{enumerate}
    \item $A \to B$ identifies local rings, and
    \item $\pi_0(\Spec (B)) \to \pi_0(\Spec (A))$ is bijective.
  \end{enumerate}
  Then $A \to B$ is an isomorphism.
\end{lemma}

\begin{proof}
  TBA.
\end{proof}
The goal of the remaining part of this section is to show that for every ring $A$, there exists a faithfully flat, ind-Zariski
$A$-algebra $A_{w}$ with $A_w$ w-local. Let $A$ be a ring.

\begin{definition}
    Let $f \in A$ be an element and $I \subseteq A$ an ideal.
    Let $S_{f, I} \subseteq A$ be the multiplicative subset of elements which map to invertible
    elements of $(A/I)_{f}$.
    We define $\tildering{A}{I}{f}$ to be the $A$-algebra $S_{f, I}^{-1}$
    and $\tildeideal{I}{f} \subseteq \tildering{A}{I}{f}$ to be the kernel of
    the induced map $\tildering{A}{I}{f} \to (A / I)_{f}$.
    \label{def:tilde-locclosed}
\end{definition}

If $Z \subseteq \spec{A}$ is a locally closed subscheme of the form $D(f) \cap V(I)$, we
also write $A_{\widetilde{Z}}$ instead of $\tildering{A}{I}{f}$.
In the following, when we use the notation $A_{\widetilde{Z}}$ there is always a canonical
choice of $I$ and $f$ for $Z$.
In general this notation is justified by the fact that, up to isomorphism, the ring $A_{\widetilde{Z}}$ does not depend
on the choice of $f$ and $I$ \stacksproject{096V}.

\begin{lemma}[{\stacksproject{096V}}]
    Let $f \in A$ be an element and $I \subseteq A$ an ideal.
    \begin{enumerate}
        \item The map $\spec{\tildering{A}{I}{f}} \to \spec{A}$ induces
            a homeomorphism onto the set of points of $\spec{A}$ specializing to $D(f) \cap V(I)$.
        \item The closed subscheme $V(\tildeideal{I}{f})$ induces a homeomorphism
            onto $D(f) \cap V(I)$.
        \item If $A'$ is a ring with an element $f' \in A$ and ideal $I' \subseteq A'$ and
            $A \to A'$ is a ring map that maps
            $D(f') \cap V(f')$ into $D(f) \cap V(f)$, then there is a unique $A$-algebra map
            $\tildering{A}{I}{f} \to \tildering{A'}{I'}{f'}$.
    \end{enumerate}
    In particular, every
    point in $\spec{\tildering{A}{I}{f}}$ specializes to a point in $V(\tildeideal{I}{f})$.
    \label{lemma:locally-closed-specializations}
\end{lemma}

\begin{proof}
    TBA
\end{proof}

In view of \ref{lemma:locally-closed-specializations}, given $Z = D(f) \cap V(I)$ we may
view $Z$ as a closed subscheme of $\spec{A_{\widetilde{Z}}}$ defined by the ideal
$V( \tildeideal{I}{f})$.

\begin{lemma}
    Let $f \in A$ be an element and $I \subseteq A$ an ideal. Then
    $\tildering{A}{I}{f}$ is ind-Zariski over $A$.
    \uses{def:tilde-locclosed}
    \label{lemma:tilde-locclosed-ind-zariski}
\end{lemma}

\begin{proof}
    $\tildering{A}{I}{f} = S^{-1} A$ for some multiplicative subset $A$.
\end{proof}

\begin{definition}[Stratification by subsets]
    Let $E, F \subseteq A$ be subsets. We define
    \[
    Z(E, F) = \bigcap_{f \in E'} D(f) \cap \bigcap_{f \in F} V(f)
    .\]
    \label{def:subset-stratum}
\end{definition}

\begin{lemma}
    Let $A$ be a ring, $E, F \subseteq A$ finite subsets. Then
    \[
    Z(E, F) = D\left( \prod_{f \in E}  f \right) \cap V\left( \sum_{f \in F} fA \right)
    .\]
    \uses{def:subset-stratum}
    \label{lemma:subset-stratum-equals-inter}
\end{lemma}

\begin{proof}
    This is immediate from the definitions of $D$ and $V$.
\end{proof}

\begin{lemma}
    Let $E_1, F_1, E_2, F_2 \subseteq A$ be subsets such that $E_1 \subseteq E_2$ and
    $F_1 \subseteq F_2$. Then $Z(E_2, F_2) \subseteq Z(E_1, F_1)$.
    \label{lemma:subset-stratum-mono}
\end{lemma}

\begin{proof}
    This is immediate from the definition of $Z(-, -)$.
\end{proof}

\begin{lemma}
    Let $A$ be a ring, $E \subseteq A$ a finite subset. Then
    \[
        \spec{A} = \coprod_{E = E' \coprod E''} Z(E', E'')
    \] set theoretically.
    \uses{def:subset-stratum}
    \label{lemma:subset-stratification}
\end{lemma}

\begin{proof}
    Let $x \in \spec{A}$ and $E = E' \coprod E''$ a disjoint union decomposition. Then
    $x \in Z(E', E'')$ if and only if $f(x) \neq 0$ for all $f \in E'$ and $f(x) = 0$
    for all $f \in E''$. Hence $x$ is contained in
    \[
    Z(\{ f \in E  \mid f(x) \neq 0\}, \{f \in E  \mid f(x) = 0\})
    ,\] and this is the only set of this form in which $x$ is contained.
\end{proof}

\begin{definition}
    Let $A$ be a ring and $E \subseteq A$ a finite subset. Let
    \[
    A_{E} = \prod_{E = E' \coprod E''} A_{\widetilde{Z(E', E'')}}
    .\]
    Further, we set $I_E \subseteq A$ to be the product of the ideals
    defining $Z(E', E'')$ in $\spec{A_{\widetilde{Z(E', E'')}}}$.
    \uses{def:subset-stratum, def:tilde-locclosed}
    \label{def:finite-stratification-ring}
\end{definition}

Note that \ref{def:finite-stratification-ring} is well-defined, because for finite
subsets $E', E''$ of $A$, the locally closed subset $Z(E', E'')$ is always
of the right form by \ref{lemma:subset-stratum-equals-inter}.

\begin{lemma}
    Let $E \subseteq A$ be a finite subset. Then
    $V(I_E) = \coprod_{E = E' \coprod E''} Z(E', E'')$. In particular,
    the map $\spec{A_E} \to \spec{A}$ induces a bijection $V(I_E) \to \spec{A}$.
    \label{lemma:finite-stratification-ideal-bijection}
    \uses{def:finite-stratification-ring}
\end{lemma}

\begin{proof}
    \uses{lemma:subset-stratification}
    By definition $I_E$ is the product of the ideals defining $Z(E', E'')$ in
    $\spec{A_{\widetilde{Z(E', E'')}}}$. Hence the first claim. The second
    follows from the first, because $\spec{A} = \coprod_{E = E' \coprod E''} Z(E', E'')$ by
    \ref{lemma:subset-stratification}.
\end{proof}

\begin{lemma}
    Let $E \subseteq A$ be a finite subset. Then $V(I_E)$ contains
    all closed points of $\spec{A_E}$.%
    \uses{def:finite-stratification-ring}
    \label{lemma:finite-stratification-closed-points}
\end{lemma}

\begin{proof}
    Let $x \in \spec{A_E}$ be a closed point. Then $x$ is a closed point
    in $\spec{A_{\widetilde{Z(E', E'')}}}$ for some $E = E' \coprod E''$. By
    \ref{lemma:locally-closed-specializations}, $x$ specializes to a point
    in $Z(E', E'') \subseteq \spec{A_{\widetilde{Z(E', E'')}}}$. But
    $x$ is closed, so $x \in Z(E', E'') \subseteq V(I_E)$.
\end{proof}

Let $A$ be a ring. Given finite subsets $E_1, E_2 \subseteq A$ with $E_1 \subseteq E_2$, there is a
canonical transition map $A_{E_1} \to A_{E_2}$ of $A$-algebras: For
a disjoint union decomposition $E_2 = E_2' \coprod E_2''$, we set
$E_1' = E_1 \cap E_2'$ and $E_1'' = E_1 \cap E_2''$. By \ref{lemma:subset-stratum-mono},
we obtain $Z(E_2', E_2'') \subseteq Z(E_1', E_1'')$ and hence
by \ref{lemma:locally-closed-specializations} a unique $A$-algebra map
$A_{\widetilde{Z(E_1', E_1'')}} \to A_{\widetilde{Z(E_2', E_2'')}}$.

\begin{definition}
    Let $I(A)$ be the partially ordered set of all finite subsets of $A$. We define the
    $A$-algebra $A_{w}$ as
    \[
    A_w = \colim_{E \in I(A)} A_E
    .\]
    We denote by $I_w \subseteq A_w$ the colimit of the ideals $I_E$, i.e.,
    the union of the images of the $I_E$ in $A_w$.%
    \uses{def:finite-stratification-ring, lemma:subset-stratum-mono}
    \label{def:w-localization}
\end{definition}

\begin{lemma}
    The $A$-algebra $A_{w}$ is ind-Zariski.
    \uses{def:w-localization}
    \label{lemma:w-localization-ind-Zariski}
\end{lemma}

\begin{proof}
    \uses{lemma:ind-Zariski-products, lemma:ind-ind-Zariski}
    For $E \subseteq A$ a finite subset, the $A$-algebra $A_E$ is ind-Zariski
    as a finite product of ind-Zariski algebras by \ref{lemma:ind-Zariski-products}.
    Thus $A_w$ is a filtered colimit of ind-Zariski algebras, hence ind-Zariski
    by \ref{lemma:ind-ind-Zariski}.
\end{proof}

\begin{lemma}
    Let $A$ be a ring.
    \begin{enumerate}
        \item The composition $V(I_w) \to \spec{A_w} \to \spec{A}$ is a bijection.
        \item $V(I_w)$ is the set of closed points of $\spec{A_w}$.
        \item Every point of $\spec{A_w}$ specializes to a unique point of $V(I_w)$.
    \end{enumerate}
    In particular, $\spec{A_w}$ is w-local and the closed points of $\spec{A_w}$ surject onto $\spec{A}$.
    \uses{def:w-localization}
    \label{lemma:w-localization-closed-points}
\end{lemma}

\begin{proof}
    \uses{lemma:finite-stratification-ideal-bijection}
    By definition of $I_w$, the set $V(I_w)$ is the intersection of the preimages
    of the $V(I_E)$ in $\spec{A_w}$.
\end{proof}

\begin{lemma}
    The $A$-algebra $A_w$ is faithfully flat.
    \uses{def:w-localization}
    \label{lemma:w-localization-faithfully-flat}
\end{lemma}

\begin{proof}
    \uses{lemma:w-localization-closed-points, lemma:w-localization-ind-Zariski}
    By \ref{lemma:w-localization-ind-Zariski}, $A \to A_w$ is flat. Because
    $V(I_w)$ surjects onto $\spec{A}$ by \ref{lemma:w-localization-closed-points},
    in particular $\spec{A_w} \to \spec{A}$ is surjective, hence
    $A \to A_w$ is faithfully flat.
\end{proof}

\section{w-strictly-local Rings}

\begin{definition}[w-strictly local rings, {\cite[Definition 2.2.1(ii)]{proetale}}]
    A ring \(A\) is \emph{w-strictly local} if \(A\) is w-local, and every local ring of \(A\) at a maximal ideal is strictly henselian.
    % TODO: every faithfully flat \'etale map \(A \to B\) has a retraction. this should be a property.
    \label{def:w-strictly-local-ring}
    \uses{def:w-local-ring,def:strictly-henselian-local-ring}
    % refactor WStrictlyLocalRing, using the definition of strictly henselian
    % \lean{WStrictlyLocalRing}
    % \leanok
\end{definition}

The goal of this section is to show that every ring $A$ admits a faithfully flat, ind-étale algebra $B$ that is $w$-strictly-local.

\begin{lemma}
  \label{thm:ind-etale-strictly-henselian-localization-isom}
  \uses{def:ind-etale,def:strictly-henselian-local-ring,def:identify-local-rings}
  Let \(A\) be a strictly henselian local ring. Let \(A \to B\) be an ind-étale ring map. Let $\n$ be an maximal ideal of $B$ lying over the maximal ideal $\m$ of $A$. Then the map $A \to B_\n$ is isomorphism.
\end{lemma}

\begin{proof}
  \uses{thm:etale-over-strictly-henselian-localization-isom} 
  Write $B = \colim_i B_i$ as a filtered colimit of étale $A$-algebras $B_i$. Since localization commutes with colimits, we have $B_\n = \colim_i (B_i)_{\n_i}$ where $\n_i$ is the restriction of $\n$ to $B_i$. Then use \Cref{thm:etale-over-strictly-henselian-localization-isom} to conclude each $B_i$ is isomorphic to $A$.
\end{proof}

\begin{lemma}
    Let $A$ be a ring such that every faithfully flat étale ring map $A \to B$ has
    a retraction. Then every local ring of $A$ at a maximal ideal is strictly henselian.
    \label{lemma:retractions-strictly-henselian}
\end{lemma}

\begin{proof}
    Let $\mathfrak{m}$ be a maximal ideal of $A$, denote by $\kappa$ the residue field $\kappa(\mathfrak{m})$
    and by $\kappa^{\mathrm{sep}}$ a separable closure of $\kappa$. Let
    $A_{\mathfrak{m}} \to B \to \kappa^{\mathrm{sep}}$ be a factorisation of $A_{\mathfrak{m}} \to \kappa^{\mathrm{sep}}$
    where $A_{\mathfrak{m}} \to B$ is étale. Since $A_{\mathfrak{m}} = \colim_{f \not\in \mathfrak{m}} A_f$,
    by \ref{lemma:etale-ind-spreads} there exists $f \not\in \mathfrak{m}$ and an étale $A_f$-algebra $B'$
    such that $B = A_{\mathfrak{m}} \otimes_{A_f} B'$.
    %Denote by $\mathfrak{q}$ the kernel of
    %the composition $B' \to B \to \kappa^{\mathrm{sep}}$.
    %Then $\mathfrak{q}$ lies over $\mathfrak{m}$ in $A$.
    Because $A \to A_f \to B'$ is étale,
    there are finitely many prime ideals $\mathfrak{q}_1, \ldots, \mathfrak{q}_n$ of $B'$ lying over $\mathfrak{m}$.
    Since the kernel of the composition $B' \to B \to \kappa^{\mathrm{sep}}$ lies over $\mathfrak{m}$
    (the kernel of $A \to \kappa_{\mathrm{sep}}$ is $\mathfrak{m}$), we have $n \ge 1$.
    Set $\mathfrak{q} = \mathfrak{q}_1$. By prime avoidance, there exists $g \in B'$ such that
    $g \in \mathfrak{q}_i$ for all $i \ge 2$ and $g \not\in \mathfrak{q}$. Hence
    $\mathfrak{q}$ is the unique prime ideal of $B'_g$ lying over $\mathfrak{m}$.

    Let $U$ be the image of the induced map $\spec{B'_g} \to \spec{A}$. Since $A \to B'$ is étale, $U$ is open.
    Since $\{\mathfrak{m}\}$ is closed in $\spec{A}$, there exist $a_i$ such that
    \[
        \spec{A} \setminus \{\mathfrak{m}\} = \bigcup_{i} D(a_i)
    .\] The complement of $U$ is closed and quasicompact, and contained in $\spec{A} \setminus \{\mathfrak{m}\}$, hence
    there exist $a_1, \ldots, a_r$ such that
    \[
        \spec{A} = U \cup \bigcup_{i=1}^r D(a_i)
    .\] Hence the map $A \to B'_g \times \prod_{i=1}^{r} A_{a_i}$ is étale and faithfully flat. By assumption,
    it therefore has a retraction $\sigma$. Since $\mathfrak{q}$ is the unique prime ideal of $B'_g \times \prod_{i=1}^{r} A_{a_i}$
    lying over $\mathfrak{m}$, we have $\sigma^{-1}(\mathfrak{m}) = \mathfrak{q}$. In particular,
    we obtain a retraction
    \[
        B'_{\mathfrak{q}} = \left(B'_g \times \prod_{i=1}^{r} A_{a_i}\right)_{\mathfrak{q}} \to A_{\mathfrak{m}}
    \] of the map $A_{\mathfrak{m}} \to B'_{\mathfrak{q}}$. Precomposing with $B' \to B'_{\mathfrak{q}}$ we obtain
    a map $B' \to A_{\mathfrak{m}}$ and hence a map
    $B = B' \otimes_{A_f} A_{\mathfrak{m}} \to A_{\mathfrak{m}}$ that is a retraction of $A_{\mathfrak{m}} \to B$.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/097R}{Tag 097R}]{stacks-project}}]
    Let $A$ be a ring. Then there exists an ind-étale faithfully flat $A$-algebra $B$ such that
    every faithfully flat étale ring map $B \to C$ has a retraction.
    \label{prop:exists-ind-etale-retraction-etale}
\end{proposition}

\begin{proof}
    For any ring $A$, one first constructs $T(A) = \colim_{E} \bigotimes_{B \in E} B$ where
    the colimit runs over finite subsets of faithfully flat étale $A$-algebras. Note that for every faithfully flat étale
    $A$-algebra $B$, there exists a map $B \to T(A)$.

    Now set $T^{n+1}(A) \coloneqq T(T^n(A))$
    and let $T^{\infty}(A) = \colim_n T^n(A)$. Let $B$ be a faithfully flat étale $T^{\infty}(A)$-algebra. Then
    by \ref{lemma:etale-ind-spreads}
    there exists $n \in \N$ and a faithfully flat, étale $T^n(A)$-algebra $B'$ such that
    $B = T^{\infty}(A) \otimes_{T^n(A)} B'$. By the earlier remark, there exists a map
    $B' \to T^{n+1}(A)$. The identity of $T^{\infty}(A)$ and the composition
    $B' \to T^{n+1}(A) \to T^{\infty}(A)$ now induce a retraction
    \[
    B = T^{\infty}(A) \otimes_{T^n(A)} B' \to T^{\infty}(A)
    .\]
\end{proof}

\begin{lemma}
    Let $k$ be a field and $A$ an ind-étale, local $k$-algebra. Then $A$ is
    a separable algebraic field extension of $k$.
    \label{lemma:field-local-indetale}
\end{lemma}

\begin{proof}
    Let $A = \colim_i A_i$ such that $A_i$ is an étale $k$-algebra for all $i$.
    Let $\mathfrak{m}$ be the maximal ideal of $A$. Since localization commutes with colimits,
    we obtain $A = A_{\mathfrak{m}} = \colim_i (A_i)_{\mathfrak{m}_i}$ where
    $\mathfrak{m}_i$ is the restriction of $\mathfrak{m}$ to $A_i$. Since $A_i$ is étale over $k$,
    it is a finite product of finite separable extensions of $k$, hence $(A_i)_{\mathfrak{m}_i}$
    is a finite separable extension of $k$. Since a filtered colimit of finite separable
    extensions is an algebraic separable extension, we conclude.
\end{proof}

\begin{proposition}
    Let $f\colon A \to B$ be ind-étale. Then $f$ induces separable algebraic extensions on residue fields.
    \label{prop:ind-etale-residue-fields}
\end{proposition}

\begin{proof}
    Let $\mathfrak{p}$ be a prime ideal of $B$. After base change along $A \to \kappa(\mathfrak{p}^c)$,
    we may assume $A = k$ is a field. After postcomposing with the ind-étale map $B \to B_{\mathfrak{p}}$,
    we may assume $B$ is local. Hence the result follows from \ref{lemma:field-local-indetale}.
\end{proof}

\begin{lemma}
    Let $A \to B$ be a faithfully flat ring map and $I \subseteq A$ an ideal.
    Then $V(IB)$ surjects onto $V(I)$.
    \label{lemma:faithfully-flat-surject-closed}
\end{lemma}

\begin{proof}
    We have $B / I B \cong A / I \otimes_A B$. Since faithfully flat is stable under base change,
    $A / I \to B / IB$ is faithfully flat. Hence $\spec{B / IB} \to \spec{A / I}$ is surjective
    and the claim follows.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/097X}{Tag 097X}]{stacks-project}}]
    For any ring \(A\), there exists an ind-étale faithfully flat \(A\)-algebra \(B\) with \(B\) w-strictly local.
    \label{thm:ind-etale-w-strictly-local-cover}
    \uses{def:w-strictly-local-ring,def:ind-etale, lemma:faithfully-flat-surject-closed}
\end{proposition}

\begin{proof}
    \uses{prop:exists-ind-etale-retraction-etale,
      lemma:retractions-strictly-henselian, prop:ind-etale-residue-fields, thm:closed-points-isom-w-local,
      lemma:w-localization-closed-points}
    By \ref{prop:w-localization-closed-points}, the ring $A_w$ is w-local, so the set of closed points
    of $\spec{A_w}$ is closed.
    Let $I$ be the radical ideal of $A_w$ such that $V(I)$ is the set of closed points of $\spec{A_w}$.
    Choose an ind-étale and faithfully flat ring map $A_w \to B'$ as in
    \ref{prop:exists-ind-etale-retraction-etale}. By
    \ref{lemma:retractions-strictly-henselian}, the local ring $B'_{\mathfrak{m}'}$ is
    strictly henselian for every maximal ideal $\mathfrak{m}'$ of $B'$.
    The map $A \to A_w$ induces algebraic extensions on residue fields at primes by
    \ref{prop:ind-etale-residue-fields},
    so applying \ref{thm:closed-points-isom-w-local} to $A_w \to B'$, we obtain
    an ind-Zariski ring map $B' \to B$ such that $B'/IB' \to B/IB$ is an isomorphism,
    $V(IB)$ is the set of closed points of $\spec{B}$ and $B$ is w-local.

    It remains to verify that the composition $A \to A_w \to B' \to B$ is ind-étale and faithfully flat.
    The first one follows because being ind-étale is stable under composition. For the second
    one it suffices to show that $\spec{B} \to \spec{B'} \to \spec{A_w} \to \spec{A}$ is surjective.
    Since the closed points of $\spec{A_w}$ surject onto $\spec{A}$ by
    \ref{lemma:w-localization-closed-points}
    and $B' / IB' \cong B / I B$, it
    suffices to check that $V(IB')$ surjects onto $V(I)$. This is \ref{lemma:faithfully-flat-surject-closed}.
\end{proof}

\begin{definition}[{\cite[\href{https://stacks.math.columbia.edu/tag/097C}{Tag 097C}]{stacks-project}}]
  \label{def:colim-open-closed-localizations}
  Let $A$ be a ring, $X = \Spec(A)$, and $T \subset \pi_0(X)$. Define the ring $A_T$ by
  \[ 
    A_T := \colim_{W} A_W,
  \]
  where $W$ runs over all open and closed subsets of $X$ containing the inverse image $Z$ of $T$, and $A \to A_W$ is the localization of $A$ at $W$.
\end{definition}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097C}{Tag 097C}]{stacks-project}}]
  \label{thm:colim-open-closed-localizations-surj-ind-zariski}
  \uses{def:colim-open-closed-localizations,def:ind-Zariski}
  Let $A$ be a ring, $X = \Spec(A)$, and $T \subset \pi_0(X)$ a closed subset. Then the map $A \to A_T$ from \Cref{def:colim-open-closed-localizations} is a surjective ind-Zariski ring map, and the induced morphism $\Spec(A_T) \to \Spec(A)$ restricts to a homeomorphism of $\Spec(A_T)$ onto the inverse image of $T$ in $X$.
\end{lemma}

\begin{proof}
  \uses{thm:intersection-closed-open-iff}
  Each $A \to A_W$ is a localization at an idempotent. Passing to filtered colimits, $A \to A_T$ is surjective and ind-Zariski.

  When $T$ is closed, its inverse image $Z$ is a closed union of connected components. By \Cref{thm:intersection-closed-open-iff}, we have
  \[
    Z = \bigcap_{\substack{Z \subseteq W \\ W \text{ open and closed}}} W.
  \]
  Thus, $\Spec(A_T) = \varprojlim_W W$ is homeomorphic to $Z$ via the natural map.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097A}{Tag 097A}]{stacks-project}}]
  \label{thm:closed-points-isom-w-local}
  \uses{def:w-local-ring,def:w-local-ring-map,def:ind-Zariski}
  Let $A$ be a w-local ring. Let $I \subset A$ be the radical ideal cutting out the set $X^c$ of closed points in $X = \Spec (A)$.
  Let $A \to B$ be a ring map inducing algebraic extensions on residue fields at primes. Then
  \begin{enumerate}
      \item every point of $Z = V(IB)$ is a closed point of $\Spec (B)$,
      \item there exists an ind-Zariski ring map $B \to C$ such that
      \begin{enumerate}
          \item $B/IB \to C/IC$ is an isomorphism, \label{item:quotinet-isom-closed-points-isom-w-local} % thus surjective on closed points
          \item $C$ is w-local, \label{item:w-local-closed-points-isom-w-local}
          \item the map $p: Y = \Spec (C) \to X$ induced by the ring map $A \to B \to C$ is w-local, and % this is not needed?
          \item $p^{-1}(X^c)$ is the set of closed points of $Y$. \label{item:inverse-image-closed-points-isom-w-local}
      \end{enumerate}
  \end{enumerate}
  In particular, the ring map $B \to C$ is faithfully flat.
\end{lemma}

\begin{proof}
    \uses{prop:exists-ind-zariski-w-local}
    TBA.

    The last statement follows from \Cref{thm:ind-Zariski-is-flat-ind-etale} and the fact that if a flat ring map induces a surjection on closed points (guaranteed by \Cref{item:w-local-closed-points-isom-w-local}), then it is faithfully flat.
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/097D}{Tag 097D}]{stacks-project}}]
Let $A$ be a ring and let $X = \Spec (A)$. Let $T$ be a profinite space and let $T \to \pi_0(X)$ be a continuous map. There exists an ind-Zariski ring map $A \to B$ such that with $Y = \Spec (B)$ the diagram
\[
\begin{tikzcd}
Y \arrow[r] \arrow[d] & \pi_0(Y) \arrow[d] \\
X \arrow[r] & \pi_0(X)
\end{tikzcd}
\]
is cartesian in the category of topological spaces and such that $\pi_0(Y) = T$ as spaces over $\pi_0(X)$.
\label{thm:exists-ind-Zariski-cartesian}
\uses{def:ind-Zariski}
\end{lemma}

\begin{proof}
  TBA
\end{proof}

\begin{lemma}[{\cite[\href{https://stacks.math.columbia.edu/tag/09AZ}{Tag 09AZ}, second part in the proof of (3) $\implies$ (1)]{stacks-project}}]
  \label{thm:ff-identifies-local-rings-plus-c-has-retraction-if}
  \uses{def:w-local-ring,def:extremally-disconnected,def:identify-local-rings}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-local, and
    \item $\pi_0(\operatorname{Spec}(A))$ is extremally disconnected.
  \end{enumerate}
  Then every faithfully flat ring map $A \to B$ identifying local rings with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\) has a retraction.
\end{lemma}

\begin{proof}
  \uses{thm:closed-points-isom-pi0,thm:extremally-disconnected-projective,def:colim-open-closed-localizations,thm:colim-open-closed-localizations-surj-ind-zariski,thm:surjective-w-local-ring,thm:ind-Zariski-identifies-local-rings,thm:w-local-map-composition,thm:identifies-local-rings-composition,thm:isom-of-identifies-local-rings-w-local-isom-pi0}
  Let $A \to B$ be faithfully flat and identifying local rings, with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\). We will show that $A \to B$ has a retraction.

  % Let $I \subset A$ be the radical ideal such that $V(I) \subset \Spec(A)$ is the set of closed points of $\Spec (A)$. We may replace $B$ by the ring $C$ constructed in \Cref{thm:closed-points-isom-w-local} for $A \to B$ and $I \subset A$. The map \(B \to C\) is faithfully flat and ind-Zariski, thus identifies local rings by \Cref{thm:ind-Zariski-identifies-local-rings}. Thus we may assume $\Spec (B)$ is w-local such that the set of closed points of $\Spec (B)$ is $V(IB)$ by \Cref{item:w-local-closed-points-isom-w-local,item:inverse-image-closed-points-isom-w-local} in \Cref{thm:closed-points-isom-w-local}.

  Choose a continuous section to the surjective continuous map $V(IB) \to V(I)$. This is possible because $V(I) = \Spec(A)^c \cong \pi_0(\Spec(A))$ (by \Cref{thm:closed-points-isom-pi0}) is extremally disconnected, see \Cref{thm:extremally-disconnected-projective}. The image is a closed subspace $T \subset \pi_0(\Spec(B)) \cong V(IB)$ (being the continuous image of the compact space $V(I)$) that maps homeomorphically onto $\pi_0(\Spec(A))$. 
  
  Let $B \to B_T$ be the ring map from \Cref{def:colim-open-closed-localizations}, which is surjective and ind-Zariski by \Cref{thm:colim-open-closed-localizations-surj-ind-zariski}. It also induces a homeomorphism $\pi_0(\Spec(B_T)) \cong T \cong \pi_0(\Spec(A))$.
  Moreover, by \Cref{thm:surjective-w-local-ring}, $B_T$ is w-local and $B \to B_T$ is w-local. Since ind-Zariski maps identify local rings (\Cref{thm:ind-Zariski-identifies-local-rings}), the composition $A \to B \to B_T$ remains w-local (\Cref{thm:w-local-map-composition}) and identifies local rings (\Cref{thm:identifies-local-rings-composition}). Therefore, by \Cref{thm:isom-of-identifies-local-rings-w-local-isom-pi0}, $A \to B_T$ is an isomorphism.
\end{proof}

\section{w-contractible rings}

\begin{definition}[w-contractible rings, {\cite[Definition 2.4.1]{proetale}}]
A ring \(A\) is \emph{w-contractible} if every faithfully flat ind-étale map \(A \to B\) has a retraction.
  \label{def:w-contractible-ring}
\end{definition}

\begin{lemma}
  \label{thm:w-contractible-if-ind-etale-plus-c-has-retraction}
  \uses{def:w-local-ring,def:ind-etale,def:w-contractible-ring}
  Let \(A\) be a w-local ring and $I \subset A$ the Jacobson radical cutting out the set $X^c$ of closed points in $X = \Spec (A)$. If every faithfully flat ind-étale map \(A \to B\) with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\) has a retraction, then \(A\) is w-strictly contractible.
\end{lemma}

\begin{proof}
  \uses{thm:closed-points-isom-w-local,thm:ind-Zariski-is-flat-ind-etale,thm:ind-etale-comp}
  Let $A \to B$ be faithfully flat and ind-étale. 
  % We will use without further mention the fact that a flat map $A \to B$ is faithfully flat if and only if every closed point of $\operatorname{Spec}(A)$ is in the image of $\operatorname{Spec}(B) \to \operatorname{Spec}(A)$. 
  We will show that $A \to B$ has a retraction.

  We may replace $B$ by the ring $C$ constructed in \Cref{thm:closed-points-isom-w-local} for $A \to B$ and $I \subset A$. To justify this, note that the map \(B \to C\) is faithfully flat and ind-Zariski, thus ind-étale by \Cref{thm:ind-Zariski-is-flat-ind-etale}. Therefore, by \Cref{thm:ind-etale-comp}, the composition \( A \to C \) is also faithfully flat and ind-étale. Hence, we may assume $\Spec (B)$ is w-local such that the set of closed points of $\Spec (B)$ is $V(IB)$ by \Cref{item:w-local-closed-points-isom-w-local,item:inverse-image-closed-points-isom-w-local} in \Cref{thm:closed-points-isom-w-local}.
\end{proof}

\begin{lemma}
  \label{thm:ind-etale-plus-c-has-retraction-if}
  \uses{def:w-strictly-local-ring,def:extremally-disconnected,def:ind-etale}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-strictly local, and \label{item:w-strictly-local-ind-etale-plus-c-has-retraction-if}
    \item $\pi_0(\Spec (A))$ is extremally disconnected. \label{item:extremally-disconnected-ind-etale-plus-c-has-retraction-if}
  \end{enumerate}
  then every faithfully flat ind-étale map \(A \to B\) with \(B\) w-local and whose closed points of \(\Spec (B)\) are exactly \(V(IB)\) has a retraction. Here $I \subset A$ is the Jacobson radical of $A$ cutting out the set $X^c$ of closed points in $X = \Spec (A)$.
\end{lemma}

\begin{proof}
  \uses{thm:ind-etale-base-change,thm:ind-etale-strictly-henselian-localization-isom,thm:ff-identifies-local-rings-plus-c-has-retraction-if}
  Let \(A \to B\) be a faithfully flat ind-étale map with \(B\) w-local and such that the closed points of \(\Spec(B)\) are exactly \(V(IB)\). In this case, \(A \to B\) identifies local rings. To justify this, it suffices to check the condition at the maximal ideals of \(B\), which lie over maximal ideals of \(A\) since they map to \(V(I) = (\Spec(A))^c\). Since \(A\) is w-strictly local, the local rings of \(A\) at its maximal ideals are strictly Henselian.

  Now fix a maximal ideal \(\mathfrak{n}\) of \(B\) and let \(\mathfrak{m} = \mathfrak{n} \cap A\) be its preimage in \(A\), which is a maximal ideal. By base change to \(A_{\mathfrak{m}}\) and applying \Cref{thm:ind-etale-base-change}, we reduce to the case where \(B\) is ind-étale over a strictly Henselian local ring \(A\), with a maximal ideal \(\mathfrak{n}\) lying over the maximal ideal \(\mathfrak{m}\) of \(A\). We then want to show \(B_{\mathfrak{n}} \cong A\). This follows from \Cref{thm:ind-etale-strictly-henselian-localization-isom}.

  Having established that \(A \to B\) identifies local rings, we conclude by \Cref{thm:ff-identifies-local-rings-plus-c-has-retraction-if} that it admits a retraction.
\end{proof}

\begin{proposition}[{\cite[\href{https://stacks.math.columbia.edu/tag/0982}{Tag 0982}, (3) $\implies$ (2)]{stacks-project}}] % actually iff, but we only need this direction
  \label{thm:w-contractible-if}
  \uses{def:w-contractible-ring,def:w-strictly-local-ring,def:extremally-disconnected}
  Let $A$ be a ring. If the following two conditions hold:
  \begin{enumerate}
    \item $A$ is w-strictly local, and
    \item $\pi_0(\Spec (A))$ is extremally disconnected.
  \end{enumerate}
  then $A$ is w-contractible.
\end{proposition}

\begin{proof}
  \uses{thm:w-contractible-if-ind-etale-plus-c-has-retraction,thm:ind-etale-plus-c-has-retraction-if}
  This is \Cref{thm:ind-etale-plus-c-has-retraction-if} with \Cref{thm:w-contractible-if-ind-etale-plus-c-has-retraction}.
  % Assume (1) or equivalently (2). We have (3)(c) by Lemma \ref{lemma:097V}. Properties (3)(a) and (3)(b) follow from Lemma \ref{lemma:09AZ}.
\end{proof}

\begin{lemma}
  If a ring \(C\) is w-strictly local, then there exists an ind-étale faithfully flat \(C\)-algebra \(D\) with \(D\) w-contractible.
  \label{thm:ind-etale-w-contractible-cover-of-w-strictly-local}
  \uses{def:w-contractible-ring,def:w-strictly-local-ring,def:ind-etale}
\end{lemma}

\begin{proof}
  % The proof goes as in https://stacks.math.columbia.edu/tag/0983, starting from the second sentence.
  \uses{thm:extremally-disconnected-cover,thm:exists-ind-Zariski-cartesian,thm:cartesian-w-local,thm:ind-Zariski-identifies-local-rings,thm:w-contractible-if}
  Choose an extremally disconnected space $T$ and a surjective continuous map $T \to \pi_0(\operatorname{Spec}(C))$ by \Cref{thm:extremally-disconnected-cover}. Note that $T$ is profinite.
  Apply \Cref{thm:exists-ind-Zariski-cartesian} to find an ind-Zariski ring map $C \to D$ such that $\pi_0(\Spec (D)) \to \pi_0(\Spec (C))$ realizes $T \to \pi_0(\Spec (C))$ and such that
  \[
  \begin{tikzcd}
  \operatorname{Spec}(D) \arrow[r] \arrow[d] & \pi_0(\operatorname{Spec}(D)) \arrow[d] \\
  \operatorname{Spec}(C) \arrow[r] & \pi_0(\operatorname{Spec}(C))
  \end{tikzcd}
  \]
  is cartesian in the category of topological spaces.

  Following \Cref{thm:cartesian-w-local}, we note that $\Spec (D)$ is w-local, that $\Spec (D) \to \Spec (C)$ is w-local, and that the set of closed points of $\Spec (D)$ is the inverse image of the set of closed points of $\Spec (C)$.

  Thus it is still true that the local rings of $D$ at its maximal ideals are strictly henselian (as they are isomorphic to the local rings at the corresponding maximal ideals of $C$ by \Cref{thm:ind-Zariski-identifies-local-rings}). It follows from \Cref{thm:w-contractible-if} that $D$ is w-contractible.
\end{proof}

\begin{theorem}[{\cite[Theorem 2.4.9]{proetale}}, {\cite[\href{https://stacks.math.columbia.edu/tag/0983}{Tag 0983}]{stacks-project}}]
  For any ring $A$, there exists an ind-étale faithfully flat $A$-algebra $D$ with $D$ w-contractible.

  \label{thm:ind-etale-w-contractible-cover-exists}
  \uses{def:w-contractible-ring,def:ind-etale}
\end{theorem}

\begin{proof}
  \uses{thm:ind-etale-w-strictly-local-cover,thm:ind-etale-w-contractible-cover-of-w-strictly-local}
  This is a combination of \Cref{thm:ind-etale-w-strictly-local-cover} and \Cref{thm:ind-etale-w-contractible-cover-of-w-strictly-local}.
\end{proof}
